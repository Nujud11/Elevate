{% extends "website/base_site.html" %}
{% load static %}

{% block content %}

<section class="min-h-[50vh] flex items-center justify-center pt-12 pb-20"
         style="background: linear-gradient(to bottom, #fdf4f2 5%, #fff 35%);">
    
     <div class="w-full px-4 sm:px-6 lg:px-8">

        <header class="text-center mb-10">
            <h1 class="text-ink text-3xl font-extrabold mb-2">
              Welcome back!
            </h1>
            <p class="text-muted text-lg">
              Login to your Account and Select your Role
            </p>
        </header>

        <div class="card p-8 sm:p-10 mx-auto max-w-4xl"> {# Card width max-w-xl #}
            
            <form method="post" action="{% url 'login' %}{% if request.GET.next %}?next={{ request.GET.next }}{% endif %}">
                {% csrf_token %}

                {% if form.non_field_errors %}
                    <div class="bg-rose/20 text-rose border border-rose p-3 rounded-md mb-4 text-sm" role="alert">
                        {% for error in form.non_field_errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}

                <div class="mb-5">
                    <label for="{{ form.username.id_for_label }}" class="block text-ink font-medium mb-2">
                        Username
                    </label>
                    {{ form.username }} {# Renders input, JS will add border-2 #}
                    {% if form.username.errors %}<p class="text-rose text-sm mt-1">{{ form.username.errors.as_text }}</p>{% endif %}
                </div>

                <div class="mb-5">
                    <label for="{{ form.password.id_for_label }}" class="block text-ink font-medium mb-2">
                        Password
                    </label>
                    <div class="relative">
                        {{ form.password }} {# Renders input, JS will add border-2 #}
                        <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-brand text-sm font-medium cursor-pointer"
                              onclick="togglePassword(this)">Show</span>
                    </div>
                    {% if form.password.errors %}<p class="text-rose text-sm mt-1">{{ form.password.errors.as_text }}</p>{% endif %}
                </div>

                <div class="flex space-x-6 mb-8 mt-6">
                    
                    <label class="flex items-center space-x-2 text-ink">
                        <input type="radio" name="role_type" value="student" checked class="form-radio h-5 w-5 text-brand border-line rounded-full focus:ring-brand">
                        <span>Student</span>
                    </label>

                    <label class="flex items-center space-x-2 text-ink">
                        <input type="radio" name="role_type" value="company" class="form-radio h-5 w-5 text-brand border-line rounded-full focus:ring-brand">
                        <span>Company</span>
                    </label>
                </div>

                <button type="submit" 
                        class="btn btn-lg w-full shadow-lg" 
                        style="background-color: var(--color-rose); color: var(--color-ink); border-color: var(--color-rose);">
                    Login
                </button>
                
                {% if request.GET.next %}
                    <input type="hidden" name="next" value="{{ request.GET.next }}">
                {% endif %}
            </form>

            <p class="text-center text-muted text-sm mt-4">
                Don't have an account? 
                <a href="{% url 'register' %}" class="text-brand font-semibold hover:text-accent">Register</a>
            </p>
        </div>
    </div>
</section>

{% block extra_js %}
<script>
    // 1. Password Toggle Script
    function togglePassword(element) {
        const passwordInput = element.closest('.relative').querySelector('input[type="password"], input[type="text"]');
        if (passwordInput.type === "password") {
            passwordInput.type = "text";
            element.textContent = "Hide";
        } else {
            passwordInput.type = "password";
            element.textContent = "Show";
        }
    }
    
    // 2. Add Tailwind classes (including border-2) to Django form fields
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        if (form) {
            form.querySelectorAll('input[type="text"], input[type="password"]').forEach(input => {
                // Ensure default classes are always present for input fields
                let classesToAdd = ['w-full', 'p-3', 'border', 'border-line', 'rounded-md', 'focus:ring-brand', 'focus:border-brand', 'border-2'];

                // Check if the input is NOT a radio button
                if (!input.classList.contains('form-radio')) {
                    input.classList.add(...classesToAdd);
                }
            });
        }
    });
</script>
{% endblock extra_js %}
{% endblock content %}